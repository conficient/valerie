/* valeriejs - MIT license - (c) egrove Ltd (egrove.co.uk) */
var valerie={};(function(){"use strict";var t,e={failed:{},passed:{},pending:{}};t=valerie.ValidationResult=function(t,n){this.state=t,this.failed=t===e.failed,this.passed=t===e.passed,this.pending=t===e.pending,this.message=n},valerie.ValidationResult.states=e,valerie.FailedValidationResult=function(n){return new t(e.failed,n)},valerie.PassedValidationResult=function(n){return new t(e.passed,n)},valerie.PendingValidationResult=function(n){return new t(e.pending,n)},valerie.ValidationResult.passed=new t(e.passed,""),valerie.ValidationResult.pending=new t(e.pending,"")})(),function(){"use strict";var t=valerie.utils=valerie.utils||{};t.asFunction=function(e){return t.isFunction(e)?e:function(){return e}},t.isArray=function(t){return"[object Array]"==={}.toString.call(t)},t.isArrayOrObject=function(t){return null===t?!1:"object"==typeof t},t.isFunction=function(t){return null==t?!1:"function"==typeof t},t.isMissing=function(t){return null==t?!0:0===t.length?!0:!1},t.isObject=function(e){return null===e?!1:t.isArray(e)?!1:"object"==typeof e},t.isString=function(t){return"[object String]"==={}.toString.call(t)},t.mergeOptions=function(e,n){var i,a,s={};null==e&&(e={}),null==n&&(n={});for(i in e)e.hasOwnProperty(i)&&(a=e[i],t.isArray(a)&&(a=a.slice(0)),s[i]=a);for(i in n)n.hasOwnProperty(i)&&(s[i]=n[i]);return s}}(),function(){"use strict";var t=valerie.formatting=valerie.formatting||{};t.addThousandsSeparator=function(t,e,n){var i=(""+t).split(n),a=i[0];return a=a.replace(/\B(?=(\d{3})+(?!\d))/g,e),i[0]=a,i.join(n)},t.replacePlaceholders=function(t,e){return null==e&&(e={}),t.replace(/\{(\w+)\}/g,function(t,n){var i=e[n];return null==i?t:""+i})},t.pad=function(t,e,n){return t=""+t,t.length>=n?t:Array(n+1-t.length).join(e)+t}}(),function(){"use strict";var t=valerie.converters=valerie.converters||{};t.passThrough={formatter:function(t){return null==t?"":""+t},parser:function(t){return t}}}(),function(){"use strict";var t=valerie.knockout=valerie.knockout||{},e=t.extras=t.extras||{};e.isolatedBindingHandler=function(t,e){var n=1===arguments.length?function(){}:t;return e=2===arguments.length?e:t,{init:function(t,i,a,s,r){n(t,i,a,s,r),ko.computed({read:function(){e(t,i,a,s,r)},disposeWhenNodeIsRemoved:t})}}},e.pausableComputed=function(t,e,n,i){var a,s,r;return s=null==i?ko.observable(!1):ko.utils.isSubscribable(i)?i:ko.observable(i),r=ko.computed(function(){return s()?a:t.call(e)},e,n),r.paused=ko.computed({read:function(){return s()},write:function(t){t&&(t=!0),t!==s()&&(t&&(a=r()),s(t))}}),r.refresh=function(){s()&&(s(!1),a=r(),s(!0))},r}}(),function(){"use strict";var t=valerie.dom=valerie.dom||{},e=/\s+/g,n=/^\s+|\s+$/g;t.classNamesStringToDictionary=function(t){var i,a,s={};if(null==t)return s;for(t=t.replace(n,""),i=t.split(e),a=0;i.length>a;a++)s[i[a]]=!0;return s},t.classNamesDictionaryToString=function(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&t[e]&&n.push(e);return n.sort(),n.join(" ")},t.setElementVisibility=function(t,e){var n="none"!==t.style.display;n!==e&&(t.style.display=e?"":"none")}}(),function(){"use strict";var t,e=valerie.FailedValidationResult,n=valerie.ValidationResult.passed,i=valerie.ValidationResult.pending,a=ko.observable,s=ko.computed,r=valerie.utils,u=valerie.formatting,o=valerie.knockout,l=o.extras,d={deferEvaluation:!0},c="validation";o.findValidationStates=function(t,e,n,i){1 in arguments||(e=!0),2 in arguments||(n=!1),3 in arguments||(i=[]);var a,s,u;for(a in t)if(t.hasOwnProperty(a)){if(u=t[a],null==u)continue;if(s=o.getValidationState(u),ko.isObservable(u)&&(u=u.peek()),r.isFunction(u))continue;r.isArrayOrObject(u)?(e&&s&&i.push(s),n&&o.findValidationStates(u,e,!0,i)):s&&i.push(s)}return i},o.getValidationState=function(t){return null==t?null:t.hasOwnProperty(c)?t[c]():null},o.hasValidationState=function(t){return null==t?!1:t.hasOwnProperty(c)},o.setValidationState=function(t,e){t[c]=function(){return e}},o.validatableModel=function(t,e){var n=new o.ModelValidationState(t,e);return o.setValidationState(t,n),n},o.validatableProperty=function(t,e){if(!ko.isSubscribable(t))throw"Only observables or computeds can be made validatable properties.";var n=new o.PropertyValidationState(t,e);return o.setValidationState(t,n),n},a.fn.validate=s.fn.validate=function(t){return o.validatableProperty(this,t)},function(){var u=function(){return this.result().failed},c=function(){var t,e,n,i=[],a=this.validationStates();for(n=0;a.length>n;n++)t=a[n],t.settings.applicable()&&(e=t.result(),e.failed&&i.push(t));return i},f=function(){return this.result().message},h=function(){return this.result().passed},v=function(){return this.result().pending},p=function(){var t,e,n=[],i=this.validationStates();for(e=0;i.length>e;e++)t=i[e],t.result().pending&&n.push(t);return n},g=function(){return this.failedStates().length>0?new e(this.settings.failureMessageFormat):this.pendingStates().length>0?i:n},m=function(){var t,e=this.validationStates();for(t=0;e.length>t;t++)if(e[t].touched())return!0;return!1},b=function(t){var e,n=this.validationStates();for(e=0;n.length>e;e++)n[e].touched(t)};t=o.ModelValidationState=function(t,e){e=r.mergeOptions(o.ModelValidationState.defaultOptions,e),e.applicable=r.asFunction(e.applicable),e.name=r.asFunction(e.name),this.model=t,this.settings=e,this.summary=a([]),this.validationStates=ko.observableArray(),this.failed=s(u,this,d),this.failedStates=s(c,this,d),this.message=s(f,this,d),this.passed=s(h,this,d),this.pending=s(v,this,d),this.pendingStates=s(p,this,d),this.result=l.pausableComputed(g,this,d,e.paused),this.touched=s({read:m,write:b,deferEvaluation:!0,owner:this}),this.paused=this.result.paused,this.refresh=this.result.refresh},t.prototype={addValidationStates:function(t){return this.validationStates.push.apply(this.validationStates,t),this},applicable:function(t){return null==t&&(t=!0),this.settings.applicable=r.asFunction(t),this},clearSummary:function(t){var e,n,i;if(this.summary([]),t)for(e=this.validationStates(),i=0;e.length>i;i++)n=e[i],n.clearSummary&&n.clearSummary();return this},name:function(t){return this.settings.name=r.asFunction(t),this},end:function(){return this.model},removeValidationStates:function(t){return this.validationStates.removeAll(t),this},stopValidatingSubModel:function(t){return this.validationStates.removeAll(t.validation().validationStates.peek()),this},updateSummary:function(t){var e,n,i=this.failedStates(),a=[];for(n=0;i.length>n;n++)e=i[n],a.push({name:e.settings.name(),message:e.message()});if(this.summary(a),t)for(i=this.validationStates(),n=0;i.length>n;n++)e=i[n],e.updateSummary&&e.updateSummary();return this},validateAll:function(){var t=o.findValidationStates(this.model,!0,!0);return this.addValidationStates(t),this},validateAllProperties:function(){var t=o.findValidationStates(this.model,!1,!0);return this.addValidationStates(t),this},validateMyProperties:function(){var t=o.findValidationStates(this.model,!1,!1);return this.addValidationStates(t),this},validateMyPropertiesAndSubModels:function(){var t=o.findValidationStates(this.model,!0,!1);return this.addValidationStates(t),this}},t.defaultOptions={applicable:r.asFunction(!0),failureMessageFormat:"",name:r.asFunction("(?)"),paused:null}}(),function(){var i=function(){var t=this.observableOrComputed(),e=this.settings.missingTest(t),n=this.settings.required();return e&&n?-1:e&&!n?0:1},c=function(){var t,e,i,a=this.observableOrComputed(),s=this.settings.rules;for(i=0;s.length>i;i++)if(t=s[i],e=t.test(a),e.failed||e.pending)return e;return n},f=function(){return this.result().failed},h=function(){var t=this.result().message;return t=u.replacePlaceholders(t,{name:this.settings.name()})},v=function(){return this.result().passed},p=function(){return this.result().pending},g=function(){var t,n;return n=this.boundEntry.result(),n.failed?n:(t=i.apply(this),-1===t?new e(this.settings.missingFailureMessage):0===t?n:c.apply(this))},m=function(){return this.settings.applicable()?this.touched()&&this.result().failed:!1};t=o.PropertyValidationState=function(t,e){e=r.mergeOptions(o.PropertyValidationState.defaultOptions,e),e.applicable=r.asFunction(e.applicable),e.name=r.asFunction(e.name),e.required=r.asFunction(e.required),this.boundEntry={focused:a(!1),result:a(n),textualInput:!1},this.observableOrComputed=t,this.settings=e,this.touched=a(!1),this.failed=s(f,this,d),this.message=l.pausableComputed(h,this,d),this.passed=s(v,this,d),this.pending=s(p,this,d),this.result=s(g,this,d),this.showMessage=l.pausableComputed(m,this,d)},t.prototype={addRule:function(t){return this.settings.rules.push(t),this},applicable:function(t){return null==t&&(t=!0),this.settings.applicable=r.asFunction(t),this},end:function(){var t,e,n=this.settings,i=n.valueFormat,a=n.converter.formatter,s=n.rules;for(t=0;s.length>t;t++)e=s[t].settings,e.valueFormat=i,e.valueFormatter=a;return this.observableOrComputed},name:function(t){return this.settings.name=r.asFunction(t),this},required:function(t){return null==t&&(t=!0),this.settings.required=r.asFunction(t),this},valueFormat:function(t){return this.settings.valueFormat=t,this}},t.defaultOptions={applicable:r.asFunction(!0),converter:valerie.converters.passThrough,entryFormat:null,invalidEntryFailureMessage:"",missingFailureMessage:"",missingTest:r.isMissing,name:r.asFunction(),required:r.asFunction(!1),rules:[],valueFormat:null}}()}(),function(){"use strict";var t=valerie.FailedValidationResult,e=valerie.ValidationResult.passed,n=valerie.utils,i=valerie.dom,a=valerie.knockout,s=valerie.converters,r=ko.bindingHandlers,u=ko.utils.registerEventHandler,o=i.setElementVisibility,l=a.getValidationState,d=valerie.knockout.extras.isolatedBindingHandler;(function(){var i,s,o=r.checked,d=r.value,c=function(t,e){var n=l(e);n.touched(!0),n.boundEntry.focused(!1),n.message.paused(!1),n.showMessage.paused(!1)},f=function(t,e){var n,i=l(e);i.boundEntry.result.peek().failed||(n=e.peek(),t.value=i.settings.converter.formatter(n,i.settings.entryFormat))},h=function(t,e){var n=l(e);n.boundEntry.focused(!0),n.message.paused(!0),n.showMessage.paused(!0)},v=function(n,i){var a,s=ko.utils.stringTrim(n.value),r=l(i),u=r.settings,o=e;0===s.length?(i(null),u.required()&&(o=new t(u.missingFailureMessage))):(a=u.converter.parser(s),i(a),null==a&&(o=new t(u.invalidEntryFailureMessage))),r.boundEntry.result(o)},p=function(t,n,i){var a=t();n.boundEntry.focused.peek()||(n.boundEntry.result(e),i.value=n.settings.converter.formatter(a,n.settings.entryFormat))};i=r.validatedChecked={init:function(t,e,i,a,s){var r=e(),d=l(r);o.init(t,e,i,a,s),d&&(u(t,"blur",function(){c(t,r)}),null==d.settings.name()&&(d.settings.name=n.asFunction(t.name)))},update:o.update},s=r.validatedValue={init:function(t,e,i,a,s){var r,o,g=e(),m=l(g);return m?(null==m.settings.name()&&(m.settings.name=n.asFunction(t.name)),u(t,"blur",function(){c(t,g)}),r=ko.utils.tagNameLower(t),(o="input"===r&&"text"===t.type.toLowerCase()||"textarea"===r)?(m.boundEntry.textualInput=!0,u(t,"blur",function(){f(t,g)}),u(t,"focus",function(){h(t,g)}),u(t,"keyup",function(){v(t,g)}),ko.computed({read:function(){p(g,m,t)},disposeWhenNodeIsRemoved:t}),void 0):(d.init(t,e,i,a,s),void 0)):(d.init(t,e,i,a,s),void 0)},update:function(t,e,n,i,a){var s=e(),r=l(s);r&&r.boundEntry.textualInput||d.update(t,e,n,i,a)}},a.originalBindingHandlers={checked:o,value:d},a.validatingBindingHandlers={checked:i,value:s},a.useValidatingBindingHandlers=function(){return r.checked=i,r.value=s,r.koChecked=o,r.koValue=d,a},a.useOriginalBindingHandlers=function(){return r.checked=o,r.value=d,a}})(),function(){var t=function(t,e,n,i,a){var s,r=i(),u=n();u===!0&&(u=r.value||r.checked||r.validatedValue||r.validatedChecked||a),s=l(u),s&&t(s,u,r)};r.disabledWhenNotValid=d(function(e,n,i,a){var s=function(t){e.disabled=!t.passed()};t(s,e,n,i,a)}),r.disabledWhenTouchedAndNotValid=d(function(e,n,i,a){var s=function(t){e.disabled=t.touched()&&!t.passed()};t(s,e,n,i,a)}),r.enabledWhenApplicable=d(function(e,n,i,a){var s=function(t){e.disabled=!t.settings.applicable()};t(s,e,n,i,a)}),r.formattedValue=d(function(t,e,n){var i,a=n(),r=e(),u=ko.utils.unwrapObservable(r),o=l(r),d=s.passThrough.formatter;o&&(d=o.settings.converter.formatter,i=o.settings.valueFormat),d=a.formatter||d,null==i&&(i=a.valueFormat),ko.utils.setTextContent(t,d(u,i))}),r.validationCss=d(function(e,n,a,s){var u=function(t){var n=r.validationCss.classNames,a=e.className,s=i.classNamesStringToDictionary(a),u=t.failed(),o=!1,l=t.passed(),d=t.pending(),c=t.touched(),f=!c;t.boundEntry&&t.boundEntry.focused()&&(o=!0),s[n.failed]=u,s[n.focused]=o,s[n.passed]=l,s[n.pending]=d,s[n.touched]=c,s[n.untouched]=f,e.className=i.classNamesDictionaryToString(s)};t(u,e,n,a,s)}),r.validationCss.classNames={failed:"error",focused:"focused",passed:"success",pending:"waiting",touched:"touched",untouched:"untouched"},r.validationMessageFor=d(function(e,n,i,a){var s=function(t){o(e,t.showMessage()),ko.utils.setTextContent(e,t.message())};t(s,e,n,i,a)}),r.visibleWhenFocused=d(function(e,n,i,a){var s=function(t){o(e,t.focused())};t(s,e,n,i,a)}),r.visibleWhenInvalid=d(function(e,n,i,a){var s=function(t){o(e,t.failed())};t(s,e,n,i,a)}),r.visibleWhenSummaryNotEmpty=d(function(e,n,i,a){var s=function(t){o(e,t.summary().length>0)};t(s,e,n,i,a)}),r.visibleWhenTouched=d(function(e,n,i,a){var s=function(t){o(e,t.touched())};t(s,e,n,i,a)}),r.visibleWhenUntouched=d(function(e,n,i,a){var s=function(t){o(e,!t.touched())};t(s,e,n,i,a)}),r.visibleWhenValid=d(function(e,n,i,a){var s=function(t){o(e,t.passed())};t(s,e,n,i,a)})}()}();