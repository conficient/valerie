"valerie for knockout (c) 2013 egrove Ltd. License: MIT (http://www.opensource.org/licenses/mit-license.php)";var valerie=valerie||{};if(function(){"use strict";var n=valerie.utils=valerie.utils||{};n.asArray=function(t){return n.isArray(t)?t:[t]},n.asFunction=function(t){return n.isFunction(t)?t:function(){return t}},n.formatString=function(n,t){return(t===undefined||t===null)&&(t={}),n.replace(/\{(\w+)\}/g,function(n,i){var r=t[i];return r===undefined||r===null?n:r.toString()})},n.isArray=function(n){return{}.toString.call(n)==="[object Array]"},n.isArrayOrObject=function(n){return n===null?!1:typeof n=="object"},n.isFunction=function(n){return n===undefined||n===null?!1:typeof n=="function"},n.isMissing=function(n){return n===undefined||n===null?!0:n.length===0?!0:!1},n.isObject=function(t){return t===null?!1:n.isArray(t)?!1:typeof t=="object"},n.mergeOptions=function(n,t){var r={},i;(n===undefined||n===null)&&(n={}),(t===undefined||t===null)&&(t={});for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(valerie=valerie||{},function(){"use strict";var n=valerie.knockout=valerie.knockout||{},t=n.extras=n.extras||{};t.isolatedBindingHandler=function(n,t){var i=arguments.length===1?function(){}:n;return t=arguments.length===2?t:n,{init:function(n,r,u,f,e){i(n,r,u,f,e),ko.computed({read:function(){t(n,r,u,f,e)},disposeWhenNodeIsRemoved:n})}}},t.pausableComputed=function(n,t,i,r){var e,u,f;return u=r===undefined||r===null?ko.observable(!1):ko.utils.isSubscribable(r)?r:ko.observable(r),f=ko.computed(function(){return u()?e:n.call(t)},t,i),f.paused=ko.computed({read:function(){return u()},write:function(n){(n=n==!0,n!==u())&&(n&&(e=f()),u(n))}}),f.refresh=function(){u()&&(u(!1),e=f(),u(!0))},f}}(),valerie=valerie||{},function(){"use strict";var n=valerie.dom=valerie.dom||{};n.setElementVisibility=function(n,t){var i=n.style.display!=="none";i!==t&&(n.style.display=t?"":"none")}}(),valerie=valerie||{},function(){"use strict";var n=valerie.converters=valerie.converters||{};n.integer={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){if(n===undefined||n===null)return undefined;var t=parseInt(n,10);return isNaN(t)?undefined:t}},n.passThrough={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){return n}},n.string={formatter:function(n){return n===undefined||n===null?"":n},parser:function(n){return n===undefined||n===null?undefined:n}}}(),valerie=valerie||{},function(){"use strict";var n=valerie.converters=valerie.converters||{};n.money={formatter:function(n,t){return n===undefined||n===null?"":((t===undefined||t===null)&&(t=""),t+n.toString())},parser:function(n){if(n===undefined||n===null)return undefined;n=n.replace("£","");var t=parseFloat(n);return isNaN(t)?undefined:t}}}(),typeof valerie=="undefined"||!valerie.utils)throw"valerie.utils is required.";if(function(){"use strict";var n=valerie.rules=valerie.rules||{},t=valerie.utils;n.PassThrough=function(){this.settings={}},n.PassThrough.prototype={test:function(){return n.successfulTestResult}},n.Range=function(i,r,u){if(arguments.length<2||arguments.length>3)throw"2 or 3 arguments expected.";this.minimum=t.asFunction(i),this.maximum=t.asFunction(r),this.settings=t.mergeOptions(n.Range.defaultOptions,u)},n.Range.defaultOptions={failureMessageFormatForMinimumOnly:"The value must be no less than {minimum}.",failureMessageFormatForMaximumOnly:"The value must be no greater than {maximum}.",failureMessageFormatForRange:"The value must be between {minimum} and {maximum}.",valueFormat:undefined,valueFormatter:valerie.converters.passThrough.formatter},n.Range.prototype={test:function(i){var o,e=this.settings.failureMessageFormatForRange,u=this.maximum(),f=this.minimum(),s=u!==undefined&&u!==null,h=f!==undefined&&f!==null,c=i!==undefined&&i!==null,r=!0;return!s&&!h?n.successfulTestResult:(c?(s?r=i<=u:e=this.settings.failureMessageFormatForMinimumOnly,h?r=r&&i>=f:e=this.settings.failureMessageFormatForMaximumOnly):r=!1,r)?n.successfulTestResult:(o=t.formatString(e,{maximum:this.settings.valueFormatter(u,this.settings.valueFormat),minimum:this.settings.valueFormatter(f,this.settings.valueFormat),value:this.settings.valueFormatter(i,this.settings.valueFormat)}),{failed:!0,failureMessage:o})}},n.successfulTestResult={failed:!1,failureMessage:""}}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(typeof valerie=="undefined"||!valerie.utils)throw"valerie.utils is required.";if(!valerie.converters)throw"valerie.converters is required.";if(!valerie.rules)throw"valerie.rules is required.";if(!valerie.knockout||!valerie.knockout.extras)throw"valerie.knockout.extras is required.";if(function(){"use strict";var u=valerie.converters,t=valerie.utils,f=valerie.rules,n=valerie.knockout,i={deferEvaluation:!0},r="validation";n.getValidationState=function(n){return n===undefined||n===null?undefined:n.hasOwnProperty(r)?n[r]():undefined},n.hasValidationState=function(n){return n===undefined||n===null?!1:n.hasOwnProperty(r)},n.setValidationState=function(n,t){n[r]=function(){return t}},n.findValidationStates=function(i,r,u,f){arguments.length<4&&(f=[]),arguments.length<3&&(u=!1),arguments.length<2&&(r=!0);var s,o,e;for(s in i)if(i.hasOwnProperty(s)){if(e=i[s],e===undefined||e===null)continue;if(o=n.getValidationState(e),ko.isObservable(e)&&(e=e.peek()),t.isFunction(e))continue;t.isArrayOrObject(e)?(r&&o&&f.push(o),u&&n.findValidationStates(e,r,!0,f)):o&&f.push(o)}return f},n.validatableModel=function(t,i){var r=new n.ModelValidationState(t,i);return n.setValidationState(t,r),r},n.validatableProperty=function(t,i){if(!ko.isSubscribable(t))throw"Only observables or computeds can be made validatable properties.";var r=new n.PropertyValidationState(t,i);return n.setValidationState(t,r),r},n.ValidationResult=function(n,t,i){this.failed=n,this.failureMessage=t,this.data=i},n.ValidationResult.success=new n.ValidationResult(!1,"",[]),function(){var r=function(){return this.result().failed},u=function(){return this.result().data},f=function(){return this.result().failureMessage},e=function(){return!this.result().failed},o=function(){for(var r=[],e,u,f=this.validationStates(),i=0;i<f.length;i++)u=f[i],u.settings.applicable()&&(e=f[i].result(),e.failed&&r.push(u));return r.length===0?n.ValidationResult.success:new n.ValidationResult(!0,t.formatString(this.settings.failureMessageFormat,{failureCount:r.length}),r)},s=function(){for(var t=this.validationStates(),n=0;n<t.length;n++)if(t[n].touched())return!0;return!1},h=function(n){for(var i=this.validationStates(),t=0;t<i.length;t++)i[t].touched(n)};n.ModelValidationState=function(c,l){l=t.mergeOptions(n.ModelValidationState.defaultOptions,l),l.applicable=t.asFunction(l.applicable),l.name=t.asFunction(l.name),this.failed=ko.computed(r,this,i),this.failureSummary=ko.observable([]),this.invalidStates=ko.computed(u,this,i),this.message=ko.computed(f,this,i),this.model=c,this.settings=l,this.passed=ko.computed(e,this,i),this.result=n.extras.pausableComputed(o,this,i,l.paused),this.touched=ko.computed({read:s,write:h,deferEvaluation:!0,owner:this}),this.validationStates=ko.observableArray(),this.paused=this.result.paused,this.refresh=this.result.refresh},n.ModelValidationState.prototype={addValidationStates:function(n){return this.validationStates.push.apply(this.validationStates,n),this},clearFailureSummary:function(){return this.failureSummary([]),this},removeValidationStates:function(n){return this.validationStates.removeAll(n),this},stopValidatingSubModel:function(n){return this.validationStates.removeAll(n.validation().validationStates.peek()),this},updateFailureSummary:function(){for(var i=[],n,r=this.validationStates(),t=0;t<r.length;t++)n=r[t],n.settings.applicable()&&n.failed()&&i.push({name:n.settings.name(),message:n.message()});return this.failureSummary(i),this},end:function(){return this.model},name:function(n){return this.settings.name=t.asFunction(n),this},validateAll:function(){var t=n.findValidationStates(this.model,!0,!0);return this.addValidationStates(t),this},validateAllProperties:function(){var t=n.findValidationStates(this.model,!1,!0);return this.addValidationStates(t),this},validateMyProperties:function(){var t=n.findValidationStates(this.model,!1,!1);return this.addValidationStates(t),this},validateMyPropertiesAndSubModels:function(){var t=n.findValidationStates(this.model,!0,!1);return this.addValidationStates(t),this}},n.ModelValidationState.defaultOptions={applicable:t.asFunction(!0),failureMessageFormat:"There are {failureCount} validation errors.",name:t.asFunction("(no-name-set)"),paused:undefined}}(),function(){var r=function(){var t=this.observableOrComputed();return!this.settings.required()||!this.settings.missingTest(t)?n.ValidationResult.success:{failed:!0,failureMessage:this.settings.missingFailureMessage}},e=function(){var n=this.observableOrComputed();return this.settings.rule.test(n)},o=function(){var t;return(t=this.boundEntry.result(),t.failed)?t:(t=r.apply(this),t.failed)?t:(t=e.apply(this),t.failed)?t:n.ValidationResult.success},s=function(){return this.result().failed},h=function(){var n=this.result().failureMessage;return t.formatString(n,{name:this.settings.name()})},c=function(){return!this.result().failed},l=function(){return this.settings.applicable()?this.touched()&&this.result().failed:!1};n.PropertyValidationState=function(r,u){u=t.mergeOptions(n.PropertyValidationState.defaultOptions,u),u.applicable=t.asFunction(u.applicable),u.name=t.asFunction(u.name),u.required=t.asFunction(u.required),this.boundEntry={focused:ko.observable(!1),result:ko.observable(n.ValidationResult.success),textualInput:!1},this.failed=ko.computed(s,this,i),this.message=n.extras.pausableComputed(h,this,i),this.observableOrComputed=r,this.settings=u,this.passed=ko.computed(c,this,i),this.result=ko.computed(o,this,i),this.showMessage=n.extras.pausableComputed(l,this,i),this.touched=ko.observable(!1)},n.PropertyValidationState.prototype={applicable:function(n){return n===undefined&&(n=!0),this.settings.applicable=t.asFunction(n),this},between:function(n,t){return this.settings.rule=new f.Range(n,t),this},end:function(){return this.settings.rule.settings.valueFormat=this.settings.valueFormat,this.settings.rule.settings.valueFormatter=this.settings.converter.formatter,this.observableOrComputed},integer:function(){return this.settings.converter=u.integer,this},name:function(n){return this.settings.name=t.asFunction(n),this},required:function(n){return n===undefined&&(n=!0),this.settings.required=t.asFunction(n),this}},n.PropertyValidationState.defaultOptions={applicable:t.asFunction(!0),converter:u.passThrough,entryFormat:undefined,invalidEntryFailureMessage:"The value entered is invalid.",missingFailureMessage:"A value is required.",missingTest:t.isMissing,name:t.asFunction(),required:t.asFunction(!1),rule:new f.PassThrough,valueFormat:undefined}}(),ko.observable.fn.validate=ko.computed.fn.validate=function(t){return n.validatableProperty(this,t)}}(),typeof valerie=="undefined"||!valerie.utils)throw"valerie.utils is required.";if(!valerie.knockout)throw"valerie.knockout is required.";if(function(){"use strict";var t=valerie.converters,i=valerie.utils,n={entryFormat:undefined,valueFormat:"£"};valerie.knockout.PropertyValidationState.prototype.money=function(r){return r=i.mergeOptions(n,r),this.settings.entryFormat=r.entryFormat,this.settings.valueFormat=r.valueFormat,this.settings.converter=t.money,this},valerie.knockout.PropertyValidationState.prototype.money.defaultOptions=n}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(typeof valerie=="undefined"||!valerie.dom)throw"valerie.dom is required.";if(!valerie.knockout)throw"valerie.knockout is required.";if(!valerie.knockout.extras)throw"valerie.knockout.extras is required.";(function(){"use strict";var t=valerie.dom,i=valerie.utils,n=valerie.knockout;(function(){var r=ko.bindingHandlers.checked,u,t=ko.bindingHandlers.value,f,e=function(t,i){var r=n.getValidationState(i);r.touched(!0),r.boundEntry.focused(!1),r.message.paused(!1),r.showMessage.paused(!1)},o=function(t,i){var r=n.getValidationState(i),u;r.boundEntry.result.peek().failed||(u=i.peek(),t.value=r.settings.converter.formatter(u,r.settings.entryFormat))},s=function(t,i){var r=n.getValidationState(i);r.boundEntry.focused(!0),r.message.paused(!0),r.showMessage.paused(!0)},h=function(t,i){var e=ko.utils.stringTrim(t.value),f,r=n.getValidationState(i),u=r.settings;if(e.length===0&&u.required()){i(undefined),r.boundEntry.result(new n.ValidationResult(!0,u.missingFailureMessage));return}if(f=u.converter.parser(e),i(f),f===undefined){r.boundEntry.result(new n.ValidationResult(!0,u.invalidEntryFailureMessage));return}r.boundEntry.result(n.ValidationResult.success)},c=function(t,i,r){var u=t();i.boundEntry.focused.peek()||(i.boundEntry.result(n.ValidationResult.success),r.value=i.settings.converter.formatter(u,i.settings.entryFormat))};u=ko.bindingHandlers.validatedChecked={init:function(t,u,f,o,s){var c=u(),h=n.getValidationState(c);r.init(t,u,f,o,s),h&&(ko.utils.registerEventHandler(t,"blur",function(){e(t,c)}),h.settings.name()===undefined&&(h.settings.name=i.asFunction(t.name)))},update:r.update},f=ko.bindingHandlers.validatedValue={init:function(r,u,f,l,a){var v=u(),p=ko.utils.tagNameLower(r),w,y=n.getValidationState(v);if(!y){t.init(r,u,f,l,a);return}if(y.settings.name()===undefined&&(y.settings.name=i.asFunction(r.name)),ko.utils.registerEventHandler(r,"blur",function(){e(r,v)}),w=p==="input"&&r.type.toLowerCase()==="text"||p==="textarea",!w){t.init(r,u,f,l,a);return}y.boundEntry.textualInput=!0,ko.utils.registerEventHandler(r,"blur",function(){o(r,v)}),ko.utils.registerEventHandler(r,"focus",function(){s(r,v)}),ko.utils.registerEventHandler(r,"keyup",function(){h(r,v)}),ko.computed({read:function(){c(v,y,r)},disposeWhenNodeIsRemoved:r})},update:function(i,r,u,f,e){var s=r(),o=n.getValidationState(s);o&&o.boundEntry.textualInput||t.update(i,r,u,f,e)}},n.originalBindingHandlers={checked:r,value:t},n.validatingBindingHandlers={checked:u,value:f},n.useValidatingBindingHandlers=function(){return ko.bindingHandlers.checked=u,ko.bindingHandlers.value=f,ko.bindingHandlers.koChecked=r,ko.bindingHandlers.koValue=t,n},n.useOriginalBindingHandlers=function(){return ko.bindingHandlers.checked=r,ko.bindingHandlers.value=t,n}})(),function(){var i=function(t,i,r,u,f){var e,o=r(),s;o===!0&&(e=u(),o=e.value||e.checked||e.validatedValue||e.validatedChecked||f),s=n.getValidationState(o),s&&t(s)};ko.bindingHandlers.enableWhenApplicable=n.extras.isolatedBindingHandler(function(n,t,r,u){var f=function(t){n.disabled=!t.settings.applicable()};i(f,n,t,r,u)}),ko.bindingHandlers.validationCss=n.extras.isolatedBindingHandler(function(n,t,r,u){var f=function(t){var i=ko.bindingHandlers.validationCss.classNames;ko.utils.toggleDomNodeCssClass(n,i.failed,t.failed()),ko.utils.toggleDomNodeCssClass(n,i.passed,t.passed()),ko.utils.toggleDomNodeCssClass(n,i.touched,t.touched())};i(f,n,t,r,u)}),ko.bindingHandlers.validationCss.classNames={failed:"error",passed:"success",touched:"touched"},ko.bindingHandlers.validationMessageFor=n.extras.isolatedBindingHandler(function(n,t,r,u){var f=function(t){valerie.dom.setElementVisibility(n,t.showMessage()),ko.utils.setTextContent(n,t.message())};i(f,n,t,r,u)}),ko.bindingHandlers.visibleWhenTouched=n.extras.isolatedBindingHandler(function(n,r,u,f){var e=function(i){t.setElementVisibility(n,!i.touched())};i(e,n,r,u,f)}),ko.bindingHandlers.visibleWhenFailuresInSummary=n.extras.isolatedBindingHandler(function(n,r,u,f){var e=function(i){t.setElementVisibility(n,i.failureSummary().length>0)};i(e,n,r,u,f)}),ko.bindingHandlers.visibleWhenTouched=n.extras.isolatedBindingHandler(function(n,r,u,f){var e=function(i){t.setElementVisibility(n,i.touched())};i(e,n,r,u,f)}),ko.bindingHandlers.visibleWhenValid=n.extras.isolatedBindingHandler(function(n,r,u,f){var e=function(i){t.setElementVisibility(n,i.passed())};i(e,n,r,u,f)})}()})();
//@ sourceMappingURL=valerie-for-knockout-gb.min.js.map