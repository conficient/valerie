"valerie for knockout (c) 2013 egrove Ltd. License: MIT (http://www.opensource.org/licenses/mit-license.php)";var valerie=valerie||{};(function(){"use strict";var n=valerie.utils=valerie.utils||{};n.asArray=function(t){return n.isArray(t)?t:[t]},n.asFunction=function(t){return n.isFunction(t)?t:function(){return t}},n.formatString=function(n,t){return(t===undefined||t===null)&&(t={}),n.replace(/\{(\w+)\}/g,function(n,i){var r=t[i];return r===undefined||r===null?n:r.toString()})},n.isArray=function(n){return{}.toString.call(n)==="[object Array]"},n.isArrayOrObject=function(n){return n===null?!1:typeof n=="object"},n.isFunction=function(n){return n===undefined||n===null?!1:typeof n=="function"},n.isMissing=function(n){return n===undefined||n===null?!0:n.length===0?!0:!1},n.isObject=function(t){return t===null?!1:n.isArray(t)?!1:typeof t=="object"},n.mergeOptions=function(n,t){var r={},i;(n===undefined||n===null)&&(n={}),(t===undefined||t===null)&&(t={});for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}})(),valerie=valerie||{},function(){"use strict";var n=valerie.knockout=valerie.knockout||{},t=n.extras=n.extras||{};t.isolatedBindingHandler=function(n,t){var i=arguments.length===1?function(){}:n;return t=arguments.length===2?t:n,{init:function(n,r,u,f,e){i(n,r,u,f,e),ko.computed({read:function(){t(n,r,u,f,e)},disposeWhenNodeIsRemoved:n})}}},t.pausableComputed=function(n,t,i,r){var e,u,f;return u=r===undefined||r===null?ko.observable(!1):ko.utils.isSubscribable(r)?r:ko.observable(r),f=ko.computed(function(){return u()?e:n.call(t)},t,i),f.paused=ko.computed({read:function(){return u()},write:function(n){(n&&(n=!0),n!==u())&&(n&&(e=f()),u(n))}}),f.refresh=function(){u()&&(u(!1),e=f(),u(!0))},f}}(),valerie=valerie||{},function(){"use strict";var n=valerie.dom=valerie.dom||{};n.setElementVisibility=function(n,t){var i=n.style.display!=="none";i!==t&&(n.style.display=t?"":"none")}}(),valerie=valerie||{},function(){"use strict";var n=valerie.converters=valerie.converters||{};n.integer={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){if(n===undefined||n===null)return undefined;var t=parseInt(n,10);return isNaN(t)?undefined:t}},n.passThrough={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){return n}},n.string={formatter:function(n){return n===undefined||n===null?"":n},parser:function(n){return n===undefined||n===null?undefined:n}}}(),function(){"use strict";var n=valerie.rules=valerie.rules||{},t=valerie.utils;n.PassThrough=function(){this.settings={}},n.PassThrough.prototype={test:function(){return n.successfulTestResult}},n.Range=function(i,r,u){if(arguments.length<2||arguments.length>3)throw"2 or 3 arguments expected.";this.minimum=t.asFunction(i),this.maximum=t.asFunction(r),this.settings=t.mergeOptions(n.Range.defaultOptions,u)},n.Range.defaultOptions={failureMessageFormatForMinimumOnly:"The value must be no less than {minimum}.",failureMessageFormatForMaximumOnly:"The value must be no greater than {maximum}.",failureMessageFormatForRange:"The value must be between {minimum} and {maximum}.",valueFormat:undefined,valueFormatter:valerie.converters.passThrough.formatter},n.Range.prototype={test:function(i){var o,e=this.settings.failureMessageFormatForRange,u=this.maximum(),f=this.minimum(),s=u!==undefined&&u!==null,h=f!==undefined&&f!==null,c=i!==undefined&&i!==null,r=!0;return!s&&!h?n.successfulTestResult:(c?(s?r=i<=u:e=this.settings.failureMessageFormatForMinimumOnly,h?r=r&&i>=f:e=this.settings.failureMessageFormatForMaximumOnly):r=!1,r)?n.successfulTestResult:(o=t.formatString(e,{maximum:this.settings.valueFormatter(u,this.settings.valueFormat),minimum:this.settings.valueFormatter(f,this.settings.valueFormat),value:this.settings.valueFormatter(i,this.settings.valueFormat)}),{failed:!0,failureMessage:o})}},n.successfulTestResult={failed:!1,failureMessage:""}}(),function(){"use strict";var t=valerie.utils,s=valerie.converters,h=valerie.rules,n=valerie.knockout,o=n.extras,f=ko.observable,r=ko.computed,i={deferEvaluation:!0},e="validation",u;n.getValidationState=function(n){return n===undefined||n===null?undefined:n.hasOwnProperty(e)?n[e]():undefined},n.hasValidationState=function(n){return n===undefined||n===null?!1:n.hasOwnProperty(e)},n.setValidationState=function(n,t){n[e]=function(){return t}},n.findValidationStates=function(i,r,u,f){1 in arguments||(r=!0),2 in arguments||(u=!1),3 in arguments||(f=[]);var s,o,e;for(s in i)if(i.hasOwnProperty(s)){if(e=i[s],e===undefined||e===null)continue;if(o=n.getValidationState(e),ko.isObservable(e)&&(e=e.peek()),t.isFunction(e))continue;t.isArrayOrObject(e)?(r&&o&&f.push(o),u&&n.findValidationStates(e,r,!0,f)):o&&f.push(o)}return f},n.validatableModel=function(t,i){var r=new n.ModelValidationState(t,i);return n.setValidationState(t,r),r},n.validatableProperty=function(t,i){if(!ko.isSubscribable(t))throw"Only observables or computeds can be made validatable properties.";var r=new n.PropertyValidationState(t,i);return n.setValidationState(t,r),r},u=n.ValidationResult=function(n,t){this.failed=n,this.failureMessage=t},u.success=new n.ValidationResult(!1,"",[]),function(){var e=function(){return this.result().failed},s=function(){for(var r=[],t=this.validationStates(),i,u,n=0;n<t.length;n++)i=t[n],i.settings.applicable()&&(u=t[n].result(),u.failed&&r.push(i));return r},h=function(){return this.result().failureMessage},c=function(){return!this.result().failed},l=function(){var i=this.invalidStates(),r;return i.length===0?n.ValidationResult.success:(r=t.formatString(this.settings.failureMessageFormat,{failureCount:i.length}),new n.ValidationResult(!0,r))},a=function(){for(var t=this.validationStates(),n=0;n<t.length;n++)if(t[n].touched())return!0;return!1},v=function(n){for(var i=this.validationStates(),t=0;t<i.length;t++)i[t].touched(n)};u=n.ModelValidationState=function(u,y){y=t.mergeOptions(n.ModelValidationState.defaultOptions,y),y.applicable=t.asFunction(y.applicable),y.name=t.asFunction(y.name),this.failed=r(e,this,i),this.failuresSnapshot=f([]),this.invalidStates=r(s,this,i),this.message=r(h,this,i),this.model=u,this.settings=y,this.passed=r(c,this,i),this.result=o.pausableComputed(l,this,i,y.paused),this.touched=r({read:a,write:v,deferEvaluation:!0,owner:this}),this.validationStates=ko.observableArray(),this.paused=this.result.paused,this.refresh=this.result.refresh},u.prototype={addValidationStates:function(n){return this.validationStates.push.apply(this.validationStates,n),this},clearFailuresSnapshot:function(n){var i,r,t;if(this.failuresSnapshot([]),n)for(i=this.validationStates(),t=0;t<i.length;t++)r=i[t],r.clearFailuresSnapshot&&r.clearFailuresSnapshot();return this},removeValidationStates:function(n){return this.validationStates.removeAll(n),this},stopValidatingSubModel:function(n){return this.validationStates.removeAll(n.validation().validationStates.peek()),this},updateFailuresSnapshot:function(n){for(var r=this.invalidStates(),i,u=[],t=0;t<r.length;t++)i=r[t],u.push({name:i.settings.name(),message:i.message()});if(this.failuresSnapshot(u),n)for(r=this.validationStates(),t=0;t<r.length;t++)i=r[t],i.updateFailuresSnapshot&&i.updateFailuresSnapshot();return this},end:function(){return this.model},name:function(n){return this.settings.name=t.asFunction(n),this},validateAll:function(){var t=n.findValidationStates(this.model,!0,!0);return this.addValidationStates(t),this},validateAllProperties:function(){var t=n.findValidationStates(this.model,!1,!0);return this.addValidationStates(t),this},validateMyProperties:function(){var t=n.findValidationStates(this.model,!1,!1);return this.addValidationStates(t),this},validateMyPropertiesAndSubModels:function(){var t=n.findValidationStates(this.model,!0,!1);return this.addValidationStates(t),this}},u.defaultOptions={applicable:t.asFunction(!0),failureMessageFormat:"There are {failureCount} validation errors.",name:t.asFunction("(no-name-set)"),paused:undefined}}(),function(){var e=function(){var t=this.observableOrComputed();return!this.settings.required()||!this.settings.missingTest(t)?n.ValidationResult.success:{failed:!0,failureMessage:this.settings.missingFailureMessage}},c=function(){var n=this.observableOrComputed();return this.settings.rule.test(n)},l=function(){var t;return(t=this.boundEntry.result(),t.failed)?t:(t=e.apply(this),t.failed)?t:(t=c.apply(this),t.failed)?t:n.ValidationResult.success},a=function(){return this.result().failed},v=function(){var n=this.result().failureMessage;return t.formatString(n,{name:this.settings.name()})},y=function(){return!this.result().failed},p=function(){return this.settings.applicable()?this.touched()&&this.result().failed:!1};u=n.PropertyValidationState=function(u,e){e=t.mergeOptions(n.PropertyValidationState.defaultOptions,e),e.applicable=t.asFunction(e.applicable),e.name=t.asFunction(e.name),e.required=t.asFunction(e.required),this.boundEntry={focused:f(!1),result:f(n.ValidationResult.success),textualInput:!1},this.failed=r(a,this,i),this.message=o.pausableComputed(v,this,i),this.observableOrComputed=u,this.settings=e,this.passed=r(y,this,i),this.result=r(l,this,i),this.showMessage=o.pausableComputed(p,this,i),this.touched=f(!1)},u.prototype={applicable:function(n){return n===undefined&&(n=!0),this.settings.applicable=t.asFunction(n),this},between:function(n,t){return this.settings.rule=new h.Range(n,t),this},end:function(){return this.settings.rule.settings.valueFormat=this.settings.valueFormat,this.settings.rule.settings.valueFormatter=this.settings.converter.formatter,this.observableOrComputed},integer:function(){return this.settings.converter=s.integer,this},name:function(n){return this.settings.name=t.asFunction(n),this},required:function(n){return n===undefined&&(n=!0),this.settings.required=t.asFunction(n),this}},u.defaultOptions={applicable:t.asFunction(!0),converter:s.passThrough,entryFormat:undefined,invalidEntryFailureMessage:"The value entered is invalid.",missingFailureMessage:"A value is required.",missingTest:t.isMissing,name:t.asFunction(),required:t.asFunction(!1),rule:new h.PassThrough,valueFormat:undefined}}(),f.fn.validate=r.fn.validate=function(t){return n.validatableProperty(this,t)}}(),function(){"use strict";var e=valerie.utils,t=valerie.knockout,n=ko.bindingHandlers,u=ko.utils.registerEventHandler,f=valerie.dom.setElementVisibility,i=t.getValidationState,r=valerie.knockout.extras.isolatedBindingHandler;(function(){var f=n.checked,o,r=n.value,s,h=function(n,t){var r=i(t);r.touched(!0),r.boundEntry.focused(!1),r.message.paused(!1),r.showMessage.paused(!1)},c=function(n,t){var r=i(t),u;r.boundEntry.result.peek().failed||(u=t.peek(),n.value=r.settings.converter.formatter(u,r.settings.entryFormat))},l=function(n,t){var r=i(t);r.boundEntry.focused(!0),r.message.paused(!0),r.showMessage.paused(!0)},a=function(n,r){var o=ko.utils.stringTrim(n.value),e,u=i(r),f=u.settings;if(o.length===0&&f.required()){r(undefined),u.boundEntry.result(new t.ValidationResult(!0,f.missingFailureMessage));return}if(e=f.converter.parser(o),r(e),e===undefined){u.boundEntry.result(new t.ValidationResult(!0,f.invalidEntryFailureMessage));return}u.boundEntry.result(t.ValidationResult.success)},v=function(n,i,r){var u=n();i.boundEntry.focused.peek()||(i.boundEntry.result(t.ValidationResult.success),r.value=i.settings.converter.formatter(u,i.settings.entryFormat))};o=n.validatedChecked={init:function(n,t,r,o,s){var l=t(),c=i(l);f.init(n,t,r,o,s),c&&(u(n,"blur",function(){h(n,l)}),c.settings.name()===undefined&&(c.settings.name=e.asFunction(n.name)))},update:f.update},s=n.validatedValue={init:function(n,t,f,o,s){var y=t(),w=ko.utils.tagNameLower(n),b,p=i(y);if(!p){r.init(n,t,f,o,s);return}if(p.settings.name()===undefined&&(p.settings.name=e.asFunction(n.name)),u(n,"blur",function(){h(n,y)}),b=w==="input"&&n.type.toLowerCase()==="text"||w==="textarea",!b){r.init(n,t,f,o,s);return}p.boundEntry.textualInput=!0,u(n,"blur",function(){c(n,y)}),u(n,"focus",function(){l(n,y)}),u(n,"keyup",function(){a(n,y)}),ko.computed({read:function(){v(y,p,n)},disposeWhenNodeIsRemoved:n})},update:function(n,t,u,f,e){var s=t(),o=i(s);o&&o.boundEntry.textualInput||r.update(n,t,u,f,e)}},t.originalBindingHandlers={checked:f,value:r},t.validatingBindingHandlers={checked:o,value:s},t.useValidatingBindingHandlers=function(){return n.checked=o,n.value=s,n.koChecked=f,n.koValue=r,t},t.useOriginalBindingHandlers=function(){return n.checked=f,n.value=r,t}})(),function(){var t=function(n,t,r,u,f){var e,o=r(),s;o===!0&&(e=u(),o=e.value||e.checked||e.validatedValue||e.validatedChecked||f),s=i(o),s&&n(s)};n.enableWhenApplicable=r(function(n,i,r,u){var f=function(t){n.disabled=!t.settings.applicable()};t(f,n,i,r,u)}),n.validationCss=r(function(i,r,u,f){var e=function(t){var r=n.validationCss.classNames;ko.utils.toggleDomNodeCssClass(i,r.failed,t.failed()),ko.utils.toggleDomNodeCssClass(i,r.passed,t.passed()),ko.utils.toggleDomNodeCssClass(i,r.touched,t.touched())};t(e,i,r,u,f)}),n.validationCss.classNames={failed:"error",passed:"success",touched:"touched"},n.validationMessageFor=r(function(n,i,r,u){var e=function(t){f(n,t.showMessage()),ko.utils.setTextContent(n,t.message())};t(e,n,i,r,u)}),n.visibleWhenTouched=r(function(n,i,r,u){var e=function(t){f(n,!t.touched())};t(e,n,i,r,u)}),n.visibleWhenFailuresInSnapshot=r(function(n,i,r,u){var e=function(t){f(n,t.failuresSnapshot().length>0)};t(e,n,i,r,u)}),n.visibleWhenTouched=r(function(n,i,r,u){var e=function(t){f(n,t.touched())};t(e,n,i,r,u)}),n.visibleWhenValid=r(function(n,i,r,u){var e=function(t){f(n,t.passed())};t(e,n,i,r,u)})}()}();
//@ sourceMappingURL=valerie-for-knockout.min.js.map