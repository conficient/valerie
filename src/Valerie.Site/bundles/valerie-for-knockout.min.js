"valerie for knockout (c) 2013 egrove Ltd. License: MIT (http://www.opensource.org/licenses/mit-license.php)";var valerie=valerie||{};if(function(){"use strict";var n=valerie.utils=valerie.utils||{};n.asArray=function(t){return n.isArray(t)?t:[t]},n.asFunction=function(t){return n.isFunction(t)?t:function(){return t}},n.formatString=function(n,t){return(t===undefined||t===null)&&(t={}),n.replace(/\{(\w+)\}/g,function(n,i){var r=t[i];return r===undefined||r===null?n:r.toString()})},n.isArray=function(n){return{}.toString.call(n)==="[object Array]"},n.isFunction=function(n){return n===undefined||n===null?!1:typeof n=="function"},n.isMissing=function(n){return n===undefined||n===null?!0:n.length===0?!0:!1},n.isObject=function(t){return t===null?!1:n.isArray(t)?!1:typeof t=="object"},n.mergeOptions=function(n,t){var r={},i;(n===undefined||n===null)&&(n={}),(t===undefined||t===null)&&(t={});for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(valerie=valerie||{},function(){"use strict";var n=valerie.knockout=valerie.knockout||{},t=n.extras=n.extras||{};t.isolatedBindingHandler=function(n,t){var i=arguments.length===1?function(){}:n;return t=arguments.length===2?t:n,{init:function(n,r,u,f,e){i(n,r,u,f,e),ko.computed({read:function(){t(n,r,u,f,e)},disposeWhenNodeIsRemoved:n})}}},t.pausableComputed=function(n,t,i){var f,u=ko.observable(!1),r=ko.computed(function(){return u()?f:n.call(t)},t,i);return r.pause=function(){f=this(),u(!0)}.bind(r),r.resume=function(){u(!1)},r}}(),valerie=valerie||{},function(){"use strict";var n=valerie.dom=valerie.dom||{};n.setElementVisibility=function(n,t){var i=n.style.display!=="none";i!==t&&(n.style.display=t?"":"none")}}(),valerie=valerie||{},function(){"use strict";var n=valerie.converters=valerie.converters||{};n.integer={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){if(n===undefined||n===null)return undefined;var t=parseInt(n,10);return isNaN(t)?undefined:t}},n.passThrough={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){return n}},n.string={formatter:function(n){return n===undefined||n===null?"":n},parser:function(n){return n===undefined||n===null?undefined:n}}}(),typeof valerie=="undefined"||!valerie.utils)throw"valerie.utils is required.";if(function(){"use strict";var n=valerie.rules=valerie.rules||{},t=valerie.utils;n.passThrough={test:function(){return n.successfulTestResult}},n.Range=function(i,r,u){if(arguments.length<2||arguments.length>3)throw"2 or 3 arguments expected.";this.minimum=t.asFunction(i),this.maximum=t.asFunction(r),this.options=t.mergeOptions(n.Range.defaultOptions,u)},n.Range.defaultOptions={failureMessageFormatForMinimumOnly:"The value must be no less than {minimum}.",failureMessageFormatForMaximumOnly:"The value must be no greater than {maximum}.",failureMessageFormatForRange:"The value must be between {minimum} and {maximum}.",valueFormatter:valerie.converters.passThrough.formatter},n.Range.prototype={test:function(i){var o,e=this.options.failureMessageFormatForRange,u=this.maximum(),f=this.minimum(),s=u!==undefined&&u!==null,h=f!==undefined&&f!==null,c=i!==undefined&&i!==null,r=!0;return!s&&!h?n.successfulTestResult:(c?(s?r=i<=u:e=this.options.failureMessageFormatForMinimumOnly,h?r=r&&i>=f:e=this.options.failureMessageFormatForMaximumOnly):r=!1,r)?n.successfulTestResult:(o=t.formatString(e,{maximum:this.options.valueFormatter(u),minimum:this.options.valueFormatter(f),value:this.options.valueFormatter(i)}),{failed:!0,failureMessage:o})}},n.successfulTestResult={failed:!1,failureMessage:""}}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(typeof valerie=="undefined"||!valerie.utils)throw"valerie.utils is required.";if(!valerie.converters)throw"valerie.converters is required.";if(!valerie.rules)throw"valerie.rules is required.";if(!valerie.knockout||!valerie.knockout.extras)throw"valerie.knockout.extras is required.";if(function(){"use strict";var u=valerie.converters,t=valerie.utils,f=valerie.rules,n=valerie.knockout,r="__valerie.knockout.validationState",e=function(){return this[r]},i={deferEvaluation:!0};n.getValidationState=function(n){return n[r]},n.hasValidationState=function(n){return n.hasOwnProperty(r)},n.setValidationState=function(n,t){n[r]=t},n.validatableModel=function(i,r){if(!t.isObject(i))throw"Currently only objects can be made validatable models. Arrays, observables and computeds are not supported.";return n.setValidationState(i,new n.ModelValidationState(r)),i.validation=e,i},n.ValidationResult=function(n,t,i){this.failed=n,this.failureMessage=t,this.data=i},n.ValidationResult.success=new n.ValidationResult(!1,"",[]),function(){var r=function(){for(var r=[],e,u,f=this.validationStates(),i=0;i<f.length;i++)u=f[i],u.options.applicable()&&(e=f[i].result(),e.failed&&r.push(u));return r.length===0?n.ValidationResult.success:new n.ValidationResult(!0,t.formatString(this.options.failureMessageFormat,{failureCount:r.length}),r)},u=function(){var n=r.apply(this);return n.failed};n.ModelValidationState=function(f){f=t.mergeOptions(n.ModelValidationState.defaultOptions,f),f.applicable=t.asFunction(f.applicable),this.failed=ko.computed(u,this,i),this.options=f,this.result=n.extras.pausableComputed(r,this,i),this.validationStates=ko.observableArray()},n.ModelValidationState.defaultOptions={applicable:t.asFunction(!0),failureMessageFormat:"There are {failureCount} validation errors."}}(),function(){var o=function(){var t=this.observableOrComputed();return!this.options.required()||!this.options.missingTest(t)?n.ValidationResult.success:{failed:!0,failureMessage:this.options.missingFailureMessage}},s=function(){var n=this.observableOrComputed();return this.options.rule.test(n)},r=function(){var t;return(t=this.boundEntry.result(),t.failed)?t:(t=o.apply(this),t.failed)?t:(t=s.apply(this),t.failed)?t:n.ValidationResult.success},e=function(){var n=r.apply(this);return n.failed},h=function(){var n=r.apply(this);return n.failureMessage},c=function(){var n=r.apply(this);return!n.failed},l=function(){return this.options.applicable()?this.boundEntry.result().failed||this.touched()&&e.apply(this):!1};n.PropertyValidationState=function(u,f){f=t.mergeOptions(n.PropertyValidationState.defaultOptions,f),f.applicable=t.asFunction(f.applicable),f.name=t.asFunction(f.name),f.required=t.asFunction(f.required),this.boundEntry={focused:ko.observable(!1),result:ko.observable(n.ValidationResult.success),textualInput:!1},this.failed=ko.computed(e,this,i),this.message=n.extras.pausableComputed(h,this,i),this.observableOrComputed=u,this.options=f,this.passed=ko.computed(c,this,i),this.result=ko.computed(r,this,i),this.showState=n.extras.pausableComputed(l,this,i),this.touched=ko.observable(!1)},n.PropertyValidationState.prototype={applicable:function(n){return n===undefined&&(n=!0),this.options.applicable=n,this},between:function(n,t){return this.options.rule=new f.Range(n,t),this},end:function(){return this.observableOrComputed},integer:function(){return this.options.converter=u.integer,this},name:function(n){this.options.name=n},required:function(n){return n===undefined&&(n=!0),this.options.required=t.asFunction(n),this}},n.PropertyValidationState.defaultOptions={applicable:!0,converter:u.passThrough,invalidEntryFailureMessage:"The value entered is invalid.",missingFailureMessage:"A value is required.",missingTest:t.isMissing,required:!1,rule:f.passThrough,valueFormat:undefined}}(),function(){var t="validation";ko.observable.fn[t]=ko.computed.fn[t]=function(t){var i=n.getValidationState(this);return i?i:(i=new n.PropertyValidationState(this,t),n.setValidationState(this,i),i)}}()}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(typeof valerie=="undefined"||!valerie.dom)throw"valerie.dom is required.";if(!valerie.knockout)throw"valerie.knockout is required.";if(!valerie.knockout.extras)throw"valerie.knockout.extras is required.";(function(){"use strict";var n=valerie.knockout;(function(){var i=ko.bindingHandlers.checked,r,t=ko.bindingHandlers.value,u,f=function(t,i){var r=n.getValidationState(i);r.touched(!0),r.boundEntry.focused(!1),r.message.resume(),r.showState.resume()},e=function(t,i){var r=n.getValidationState(i);r.boundEntry.result.peek().failed||(t.value=r.options.converter.formatter(i.peek()))},o=function(t,i){var r=n.getValidationState(i);r.boundEntry.focused(!0),r.message.pause(),r.showState.pause()},s=function(t,i){var e=ko.utils.stringTrim(t.value),f,r=n.getValidationState(i),u=r.options;if(e.length===0&&u.required()){i(undefined),r.boundEntry.result(new n.ValidationResult(!0,u.missingFailureMessage));return}if(f=u.converter.parser(e),i(f),f===valerie.invalid){r.boundEntry.result(new n.ValidationResult(!0,u.invalidEntryFailureMessage));return}r.boundEntry.result(n.ValidationResult.success)},h=function(t,i,r){var u=t();i.boundEntry.focused.peek()||(i.boundEntry.result(n.ValidationResult.success),r.value=i.options.converter.formatter(u,i.options.valueFormat))};r=ko.bindingHandlers.validatedChecked={init:function(t,r,u,e,o){var s=r();i.init(t,r,u,e,o),n.hasValidationState(s)&&ko.utils.registerEventHandler(t,"blur",function(){f(t,s)})},update:i.update},u=ko.bindingHandlers.validatedValue={init:function(i,r,u,c,l){var a=r(),y=ko.utils.tagNameLower(i),p,v=n.getValidationState(a);if(!v){t.init(i,r,u,c,l);return}if(ko.utils.registerEventHandler(i,"blur",function(){f(i,a)}),p=y==="input"&&i.type.toLowerCase()==="text"||y==="textarea",!p){t.init(i,r,u,c,l);return}v.boundEntry.textualInput=!0,ko.utils.registerEventHandler(i,"blur",function(){e(i,a)}),ko.utils.registerEventHandler(i,"focus",function(){o(i,a)}),ko.utils.registerEventHandler(i,"keyup",function(){s(i,a)}),ko.computed({read:function(){h(a,v,i)},disposeWhenNodeIsRemoved:i})},update:function(i,r,u,f,e){var s=r(),o=n.getValidationState(s);o&&o.boundEntry.textualInput||t.update(i,r,u,f,e)}},n.originalBindingHandlers={checked:i,value:t},n.validatingBindingHandlers={checked:r,value:u},n.useValidatingBindingHandlers=function(){return ko.bindingHandlers.checked=r,ko.bindingHandlers.value=u,ko.bindingHandlers.koChecked=i,ko.bindingHandlers.koValue=t,n},n.useOriginalBindingHandlers=function(){return ko.bindingHandlers.checked=i,ko.bindingHandlers.value=t,n}})(),ko.bindingHandlers.enabledWhenApplicable=n.extras.isolatedBindingHandler(function(t,i,r){var u,f=i(),e;f===!0&&(u=r(),f=u.value||u.checked||u.validatedValue||u.validatedChecked),e=n.getValidationState(f),e&&(t.disabled=!e.options.applicable())}),function(){var t=function(t,i,r){var u,e=i(),f=n.getValidationState(e);f&&(u=r(f),valerie.dom.setElementVisibility(t,u))};ko.bindingHandlers.visibleWhenInvalid=n.extras.isolatedBindingHandler(function(n,i){t(n,i,function(n){return n.failed()})}),ko.bindingHandlers.visibleWhenValid=n.extras.isolatedBindingHandler(function(n,i){t(n,i,function(n){return n.passed()})})}(),ko.bindingHandlers.validationMessageFor=n.extras.isolatedBindingHandler(function(t,i){var u=i(),r=n.getValidationState(u);r&&(valerie.dom.setElementVisibility(t,r.showState()),ko.utils.setTextContent(t,r.message()))})})();
//@ sourceMappingURL=valerie-for-knockout.min.js.map