"valerie for knockout (c) 2013 egrove Ltd. License: MIT (http://www.opensource.org/licenses/mit-license.php)";var valerie=valerie||{};if(function(){"use strict";var n=valerie.utils=valerie.utils||{};n.asArray=function(t){return n.isArray(t)?t:[t]},n.asFunction=function(t){return n.isFunction(t)?t:function(){return t}},n.formatString=function(n,t){return(t===undefined||t===null)&&(t={}),n.replace(/\{(\w+)\}/g,function(n,i){var r=t[i];return r===undefined||r===null?n:r.toString()})},n.isArray=function(n){return{}.toString.call(n)==="[object Array]"},n.isArrayOrObject=function(n){return n===null?!1:typeof n=="object"},n.isFunction=function(n){return n===undefined||n===null?!1:typeof n=="function"},n.isMissing=function(n){return n===undefined||n===null?!0:n.length===0?!0:!1},n.isObject=function(t){return t===null?!1:n.isArray(t)?!1:typeof t=="object"},n.mergeOptions=function(n,t){var r={},i;(n===undefined||n===null)&&(n={}),(t===undefined||t===null)&&(t={});for(i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(valerie=valerie||{},function(){"use strict";var n=valerie.knockout=valerie.knockout||{},t=n.extras=n.extras||{};t.isolatedBindingHandler=function(n,t){var i=arguments.length===1?function(){}:n;return t=arguments.length===2?t:n,{init:function(n,r,u,f,e){i(n,r,u,f,e),ko.computed({read:function(){t(n,r,u,f,e)},disposeWhenNodeIsRemoved:n})}}},t.pausableComputed=function(n,t,i,r){var e,u,f;return u=r===undefined||r===null?ko.observable(!1):ko.utils.isSubscribable(r)?r:ko.observable(r),f=ko.computed(function(){return u()?e:n.call(t)},t,i),f.paused=ko.computed({read:function(){return u()},write:function(n){(n=n==!0,n!==u())&&(n&&(e=f()),u(n))}}),f.refresh=function(){u()&&(u(!1),e=f(),u(!0))},f}}(),valerie=valerie||{},function(){"use strict";var n=valerie.dom=valerie.dom||{};n.setElementVisibility=function(n,t){var i=n.style.display!=="none";i!==t&&(n.style.display=t?"":"none")}}(),valerie=valerie||{},function(){"use strict";var n=valerie.converters=valerie.converters||{};n.integer={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){if(n===undefined||n===null)return undefined;var t=parseInt(n,10);return isNaN(t)?undefined:t}},n.passThrough={formatter:function(n){return n===undefined||n===null?"":n.toString()},parser:function(n){return n}},n.string={formatter:function(n){return n===undefined||n===null?"":n},parser:function(n){return n===undefined||n===null?undefined:n}}}(),typeof valerie=="undefined"||!valerie.utils)throw"valerie.utils is required.";if(function(){"use strict";var n=valerie.rules=valerie.rules||{},t=valerie.utils;n.PassThrough=function(){this.options={}},n.PassThrough.prototype={test:function(){return n.successfulTestResult}},n.Range=function(i,r,u){if(arguments.length<2||arguments.length>3)throw"2 or 3 arguments expected.";this.minimum=t.asFunction(i),this.maximum=t.asFunction(r),this.options=t.mergeOptions(n.Range.defaultOptions,u)},n.Range.defaultOptions={failureMessageFormatForMinimumOnly:"The value must be no less than {minimum}.",failureMessageFormatForMaximumOnly:"The value must be no greater than {maximum}.",failureMessageFormatForRange:"The value must be between {minimum} and {maximum}.",valueFormat:undefined,valueFormatter:valerie.converters.passThrough.formatter},n.Range.prototype={test:function(i){var o,e=this.options.failureMessageFormatForRange,u=this.maximum(),f=this.minimum(),s=u!==undefined&&u!==null,h=f!==undefined&&f!==null,c=i!==undefined&&i!==null,r=!0;return!s&&!h?n.successfulTestResult:(c?(s?r=i<=u:e=this.options.failureMessageFormatForMinimumOnly,h?r=r&&i>=f:e=this.options.failureMessageFormatForMaximumOnly):r=!1,r)?n.successfulTestResult:(o=t.formatString(e,{maximum:this.options.valueFormatter(u,this.options.valueFormat),minimum:this.options.valueFormatter(f,this.options.valueFormat),value:this.options.valueFormatter(i,this.options.valueFormat)}),{failed:!0,failureMessage:o})}},n.successfulTestResult={failed:!1,failureMessage:""}}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(typeof valerie=="undefined"||!valerie.utils)throw"valerie.utils is required.";if(!valerie.converters)throw"valerie.converters is required.";if(!valerie.rules)throw"valerie.rules is required.";if(!valerie.knockout||!valerie.knockout.extras)throw"valerie.knockout.extras is required.";if(function(){"use strict";var u=valerie.converters,t=valerie.utils,f=valerie.rules,n=valerie.knockout,i={deferEvaluation:!0},r="validation";n.getValidationState=function(n){return n===undefined||n===null?undefined:n.hasOwnProperty(r)?n[r]():undefined},n.hasValidationState=function(n){return n===undefined||n===null?!1:n.hasOwnProperty(r)},n.setValidationState=function(n,t){n[r]=function(){return t}},n.findValidationStates=function(i,r,u,f){arguments.length<4&&(f=[]),arguments.length<3&&(u=!1),arguments.length<2&&(r=!0);var s,o,e;for(s in i)if(i.hasOwnProperty(s)){if(e=i[s],e===undefined||e===null)continue;if(o=n.getValidationState(e),ko.isObservable(e)&&(e=e.peek()),t.isFunction(e))continue;t.isArrayOrObject(e)?(r&&o&&f.push(o),u&&n.findValidationStates(e,r,!0,f)):o&&f.push(o),n.findValidationStates(e,!0,f)}return f},n.validatableModel=function(t,i){var r=new n.ModelValidationState(t,i);return n.setValidationState(t,r),r},n.validatableProperty=function(t,i){if(!ko.isSubscribable(t))throw"Only observables or computeds can be made validatable properties.";var r=new n.PropertyValidationState(t,i);return n.setValidationState(t,r),r},n.ValidationResult=function(n,t,i){this.failed=n,this.failureMessage=t,this.data=i},n.ValidationResult.success=new n.ValidationResult(!1,"",[]),function(){var r=function(){return this.result().failed},u=function(){return this.result().data},f=function(){return this.result().failureMessage},e=function(){return!this.result().failed},o=function(){for(var r=[],e,u,f=this.validationStates(),i=0;i<f.length;i++)u=f[i],u.options.applicable()&&(e=f[i].result(),e.failed&&r.push(u));return r.length===0?n.ValidationResult.success:new n.ValidationResult(!0,t.formatString(this.options.failureMessageFormat,{failureCount:r.length}),r)};n.ModelValidationState=function(s,h){h=t.mergeOptions(n.ModelValidationState.defaultOptions,h),h.applicable=t.asFunction(h.applicable),h.name=t.asFunction(h.name),this.failed=ko.computed(r,this,i),this.invalidStates=ko.computed(u,this,i),this.message=ko.computed(f,this,i),this.model=s,this.options=h,this.passed=ko.computed(e,this,i),this.result=n.extras.pausableComputed(o,this,i,h.paused),this.touched=ko.observable(!1),this.validationStates=ko.observableArray(),this.paused=this.result.paused,this.refresh=this.result.refresh},n.ModelValidationState.prototype={addValidationStates:function(n){this.validationStates.push.apply(this.validationStates,n)},end:function(){return this.model},name:function(n){return this.options.name=t.asFunction(n),this},removeValidationStates:function(n){this.validationStates.removeAll(n)},stopValidatingSubModel:function(n){this.validationStates.removeAll(n.validation().validationStates.peek())},touch:function(){for(var t=this.validationStates.peek(),n=0;n<t.length;n++)t[n].touch();this.touched(!0)},validateAll:function(){var t=n.findValidationStates(this.model,!0,!0);return this.addValidationStates(t),this},validateAllProperties:function(){var t=n.findValidationStates(this.model,!1,!0);return this.addValidationStates(t),this},validateMyProperties:function(){var t=n.findValidationStates(this.model,!1,!1);return this.addValidationStates(t),this},validateMyPropertiesAndSubModels:function(){var t=n.findValidationStates(this.model,!0,!1);return this.addValidationStates(t),this}},n.ModelValidationState.defaultOptions={applicable:t.asFunction(!0),failureMessageFormat:"There are {failureCount} validation errors.",name:t.asFunction("(no-name-set)"),paused:undefined}}(),function(){var r=function(){var t=this.observableOrComputed();return!this.options.required()||!this.options.missingTest(t)?n.ValidationResult.success:{failed:!0,failureMessage:this.options.missingFailureMessage}},e=function(){var n=this.observableOrComputed();return this.options.rule.test(n)},o=function(){var t;return(t=this.boundEntry.result(),t.failed)?t:(t=r.apply(this),t.failed)?t:(t=e.apply(this),t.failed)?t:n.ValidationResult.success},s=function(){return this.result().failed},h=function(){return this.result().failureMessage},c=function(){return!this.result().failed},l=function(){return this.options.applicable()?this.boundEntry.result().failed||this.touched()&&this.result().failed:!1};n.PropertyValidationState=function(r,u){u=t.mergeOptions(n.PropertyValidationState.defaultOptions,u),u.applicable=t.asFunction(u.applicable),u.name=t.asFunction(u.name),u.required=t.asFunction(u.required),this.boundEntry={focused:ko.observable(!1),result:ko.observable(n.ValidationResult.success),textualInput:!1},this.failed=ko.computed(s,this,i),this.message=n.extras.pausableComputed(h,this,i),this.observableOrComputed=r,this.options=u,this.passed=ko.computed(c,this,i),this.result=ko.computed(o,this,i),this.showState=n.extras.pausableComputed(l,this,i),this.touched=ko.observable(!1)},n.PropertyValidationState.prototype={applicable:function(n){return n===undefined&&(n=!0),this.options.applicable=t.asFunction(n),this},between:function(n,t){return this.options.rule=new f.Range(n,t),this},end:function(){return this.options.rule.options.valueFormat=this.options.valueFormat,this.options.rule.options.valueFormatter=this.options.converter.formatter,this.observableOrComputed},integer:function(){return this.options.converter=u.integer,this},name:function(n){return this.options.name=t.asFunction(n),this},required:function(n){return n===undefined&&(n=!0),this.options.required=t.asFunction(n),this},touch:function(){this.touched(!0)}},n.PropertyValidationState.defaultOptions={applicable:t.asFunction(!0),converter:u.passThrough,entryFormat:undefined,invalidEntryFailureMessage:"The value entered is invalid.",missingFailureMessage:"A value is required.",missingTest:t.isMissing,name:t.asFunction(),required:t.asFunction(!1),rule:new f.PassThrough,valueFormat:undefined}}(),ko.observable.fn.validate=ko.computed.fn.validate=function(t){return n.validatableProperty(this,t)}}(),typeof ko=="undefined")throw"KnockoutJS is required.";if(typeof valerie=="undefined"||!valerie.dom)throw"valerie.dom is required.";if(!valerie.knockout)throw"valerie.knockout is required.";if(!valerie.knockout.extras)throw"valerie.knockout.extras is required.";(function(){"use strict";var t=valerie.utils,n=valerie.knockout;(function(){var r=ko.bindingHandlers.checked,u,i=ko.bindingHandlers.value,f,e=function(t,i){var r=n.getValidationState(i);r.touched(!0),r.boundEntry.focused(!1),r.message.paused(!1),r.showState.paused(!1)},o=function(t,i){var r=n.getValidationState(i),u;r.boundEntry.result.peek().failed||(u=i.peek(),t.value=r.options.converter.formatter(u,r.options.entryFormat))},s=function(t,i){var r=n.getValidationState(i);r.boundEntry.focused(!0),r.message.paused(!0),r.showState.paused(!0)},h=function(t,i){var e=ko.utils.stringTrim(t.value),f,r=n.getValidationState(i),u=r.options;if(e.length===0&&u.required()){i(undefined),r.boundEntry.result(new n.ValidationResult(!0,u.missingFailureMessage));return}if(f=u.converter.parser(e),i(f),f===undefined){r.boundEntry.result(new n.ValidationResult(!0,u.invalidEntryFailureMessage));return}r.boundEntry.result(n.ValidationResult.success)},c=function(t,i,r){var u=t();i.boundEntry.focused.peek()||(i.boundEntry.result(n.ValidationResult.success),r.value=i.options.converter.formatter(u,i.options.entryFormat))};u=ko.bindingHandlers.validatedChecked={init:function(i,u,f,o,s){var c=u(),h=n.getValidationState(c);r.init(i,u,f,o,s),h&&(ko.utils.registerEventHandler(i,"blur",function(){e(i,c)}),h.options.name()===undefined&&(h.options.name=t.asFunction(i.name)))},update:r.update},f=ko.bindingHandlers.validatedValue={init:function(r,u,f,l,a){var v=u(),p=ko.utils.tagNameLower(r),w,y=n.getValidationState(v);if(!y){i.init(r,u,f,l,a);return}if(y.options.name()===undefined&&(y.options.name=t.asFunction(r.name)),ko.utils.registerEventHandler(r,"blur",function(){e(r,v)}),w=p==="input"&&r.type.toLowerCase()==="text"||p==="textarea",!w){i.init(r,u,f,l,a);return}y.boundEntry.textualInput=!0,ko.utils.registerEventHandler(r,"blur",function(){o(r,v)}),ko.utils.registerEventHandler(r,"focus",function(){s(r,v)}),ko.utils.registerEventHandler(r,"keyup",function(){h(r,v)}),ko.computed({read:function(){c(v,y,r)},disposeWhenNodeIsRemoved:r})},update:function(t,r,u,f,e){var s=r(),o=n.getValidationState(s);o&&o.boundEntry.textualInput||i.update(t,r,u,f,e)}},n.originalBindingHandlers={checked:r,value:i},n.validatingBindingHandlers={checked:u,value:f},n.useValidatingBindingHandlers=function(){return ko.bindingHandlers.checked=u,ko.bindingHandlers.value=f,ko.bindingHandlers.koChecked=r,ko.bindingHandlers.koValue=i,n},n.useOriginalBindingHandlers=function(){return ko.bindingHandlers.checked=r,ko.bindingHandlers.value=i,n}})(),ko.bindingHandlers.enableWhenApplicable=n.extras.isolatedBindingHandler(function(t,i,r){var u,f=i(),e;f===!0&&(u=r(),f=u.value||u.checked||u.validatedValue||u.validatedChecked),e=n.getValidationState(f),e&&(t.disabled=!e.options.applicable())}),function(){var t=function(t,i,r){var u,e=i(),f=n.getValidationState(e);f&&(u=r(f),valerie.dom.setElementVisibility(t,u))};ko.bindingHandlers.visibleWhenInvalid=n.extras.isolatedBindingHandler(function(n,i){t(n,i,function(n){return n.failed()})}),ko.bindingHandlers.visibleWhenValid=n.extras.isolatedBindingHandler(function(n,i){t(n,i,function(n){return n.passed()})})}(),ko.bindingHandlers.validationMessageFor=n.extras.isolatedBindingHandler(function(t,i){var u=i(),r=n.getValidationState(u);r&&(valerie.dom.setElementVisibility(t,r.showState()),ko.utils.setTextContent(t,r.message()))})})();
//@ sourceMappingURL=valerie-for-knockout.min.js.map